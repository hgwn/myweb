!function(){"use strict";angular.module("ngTreetable",[]).factory("ngTreetableParams",["$log",function(e){var t=function(t){var n=this;this.getNodes=function(e){},this.getTemplate=function(e){},this.options={},this.refresh=function(){},angular.isObject(t)&&angular.forEach(t,function(t,a){["getNodes","getTemplate","options"].indexOf(a)>-1?n[a]=t:e.warn('ngTreetableParams - Ignoring unexpected property "'+a+'".')})};return t}]).controller("TreetableController",["$scope","$element","$compile","$templateCache","$q","$http",function(e,t,n,a,o,r){var l=0,i=e.ttParams,d=t;e.compileElement=function(t,o,d){var s=(i.getTemplate(t),r.get(i.getTemplate(t),{cache:a}).then(function(e){return e.data}));return s.then(function(a){var r=e.$parent.$new();return angular.extend(r,{node:t,parentNode:d,_num:l}),l++,r._ttParentId=o,n(a)(r).get(0)})},e.addChildren=function(n,a){var r=n?n.scope().node:null,l=n?n.data("ttId"):null;n&&(n.scope().loading=!0),o.when(i.getNodes(r)).then(function(i){var s=[];angular.forEach(i,function(t){s.push(e.compileElement(t,l,r))}),o.all(s).then(function(o){var r=null!=l?d.treetable("node",l):null;t.treetable("loadBranch",r,o),a&&angular.forEach(o,function(t){e.addChildren($(t),a)}),n&&(n.scope().loading=!1)})})},e.onNodeExpand=function(){this.row.scope().loading||(d.treetable("unloadBranch",this),e.addChildren(this.row,e.shouldExpand()))},e.onNodeCollapse=function(){this.row.scope().loading||d.treetable("unloadBranch",this)},e.refresh=function(){for(var t=d.data("treetable").nodes;t.length>0;)d.treetable("removeNode",t[0].id);e.addChildren(null,e.shouldExpand())},i.refresh=e.refresh,e.editRefresh=function(e){d.treetable("removeNode",e[0])},i.editRefresh=e.editRefresh,e.collapsed=function(e){d.treetable("collapseNode",e[0])},i.collapsed=e.collapsed,e.getOptions=function(){var t=angular.extend({expandable:!0,onNodeExpand:e.onNodeExpand,onNodeCollapse:e.onNodeCollapse},i.options);return i.options&&angular.forEach(["onNodeCollapse","onNodeExpand"],function(n){i.options[n]&&(t[n]=function(){e[n].apply(this,arguments),i.options[n].apply(this,arguments)})}),t},e.shouldExpand=function(){return"expanded"===e.options.initialState},e.options=e.getOptions(),d.treetable(e.options),e.addChildren(null,e.shouldExpand())}]).directive("ttTable",[function(){return{restrict:"AC",scope:{ttParams:"="},controller:"TreetableController"}}]).directive("ttNode",[function(){var e=0;return{restrict:"AC",scope:{isBranch:"=",parent:"="},link:function(t,n,a){var o=angular.isDefined(t.isBranch)?t.isBranch:!0,r=angular.isDefined(t.parent)?t.parent:t.$parent._ttParentId;n.attr("data-tt-id",e++),n.attr("data-tt-branch",o),n.attr("data-tt-parent-id",r)}}}])}();