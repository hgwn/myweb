!function(e){"use strict";function t(e){var t={};return t.VERSION="4.0.0-b2",t.WIRE_TYPES={},t.WIRE_TYPES.VARINT=0,t.WIRE_TYPES.BITS64=1,t.WIRE_TYPES.LDELIM=2,t.WIRE_TYPES.STARTGROUP=3,t.WIRE_TYPES.ENDGROUP=4,t.WIRE_TYPES.BITS32=5,t.PACKABLE_WIRE_TYPES=[t.WIRE_TYPES.VARINT,t.WIRE_TYPES.BITS64,t.WIRE_TYPES.BITS32],t.TYPES={int32:{name:"int32",wireType:t.WIRE_TYPES.VARINT},uint32:{name:"uint32",wireType:t.WIRE_TYPES.VARINT},sint32:{name:"sint32",wireType:t.WIRE_TYPES.VARINT},int64:{name:"int64",wireType:t.WIRE_TYPES.VARINT},uint64:{name:"uint64",wireType:t.WIRE_TYPES.VARINT},sint64:{name:"sint64",wireType:t.WIRE_TYPES.VARINT},bool:{name:"bool",wireType:t.WIRE_TYPES.VARINT},"double":{name:"double",wireType:t.WIRE_TYPES.BITS64},string:{name:"string",wireType:t.WIRE_TYPES.LDELIM},bytes:{name:"bytes",wireType:t.WIRE_TYPES.LDELIM},fixed32:{name:"fixed32",wireType:t.WIRE_TYPES.BITS32},sfixed32:{name:"sfixed32",wireType:t.WIRE_TYPES.BITS32},fixed64:{name:"fixed64",wireType:t.WIRE_TYPES.BITS64},sfixed64:{name:"sfixed64",wireType:t.WIRE_TYPES.BITS64},"float":{name:"float",wireType:t.WIRE_TYPES.BITS32},"enum":{name:"enum",wireType:t.WIRE_TYPES.VARINT},message:{name:"message",wireType:t.WIRE_TYPES.LDELIM},group:{name:"group",wireType:t.WIRE_TYPES.STARTGROUP}},t.ID_MIN=1,t.ID_MAX=536870911,t.ByteBuffer=e,t.Long=e.Long||null,t.convertFieldsToCamelCase=!1,t.populateAccessors=!0,t.Util=function(){Object.create||(Object.create=function(e){function t(){}if(arguments.length>1)throw Error("Object.create polyfill only accepts the first parameter.");return t.prototype=e,new t});var e={};e.IS_NODE=!1;try{e.IS_NODE="function"==typeof require&&"function"==typeof require("fs").readFileSync&&"function"==typeof require("path").resolve}catch(t){}return e.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,i=0;i<e.length;i++){try{t=e[i]()}catch(n){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},e.fetch=function(t,i){if(i&&"function"!=typeof i&&(i=null),e.IS_NODE)if(i)require("fs").readFile(t,function(e,t){i(e?null:""+t)});else try{return require("fs").readFileSync(t)}catch(n){return null}else{var r=e.XHR();if(r.open("GET",t,i?!0:!1),r.setRequestHeader("Accept","text/plain"),"function"==typeof r.overrideMimeType&&r.overrideMimeType("text/plain"),!i)return r.send(null),200==r.status||0==r.status&&"string"==typeof r.responseText?r.responseText:null;if(r.onreadystatechange=function(){4==r.readyState&&i(200==r.status||0==r.status&&"string"==typeof r.responseText?r.responseText:null)},4==r.readyState)return;r.send(null)}},e.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},e}(),t.Lang={OPEN:"{",CLOSE:"}",OPTOPEN:"[",OPTCLOSE:"]",OPTEND:",",EQUAL:"=",END:";",STRINGOPEN:'"',STRINGCLOSE:'"',STRINGOPEN_SQ:"'",STRINGCLOSE_SQ:"'",COPTOPEN:"(",COPTCLOSE:")",DELIM:/[\s\{\}=;\[\],'"\(\)]/g,RULE:/^(?:required|optional|repeated)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0x[0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,ID:/^(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0x[0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,BOOL:/^(?:true|false)$/i},t.DotProto=function(e,t){var i={},n=function(e){this.source=""+e,this.index=0,this.line=1,this.stack=[],this.readingString=!1,this.stringEndsWith=t.STRINGCLOSE},r=n.prototype;r._readString=function(){t.STRING.lastIndex=this.index-1;var e;if(null!==(e=t.STRING.exec(this.source))){var i="undefined"!=typeof e[1]?e[1]:e[2];return this.index=t.STRING.lastIndex,this.stack.push(this.stringEndsWith),i}throw Error("Unterminated string at line "+this.line+", index "+this.index)},r.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(this.readingString)return this.readingString=!1,this._readString();var e,i;do{for(e=!1;t.WHITESPACE.test(i=this.source.charAt(this.index));)if(this.index++,"\n"===i&&this.line++,this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if("/"===this.source.charAt(++this.index)){for(;"\n"!==this.source.charAt(this.index);)if(this.index++,this.index==this.source.length)return null;this.index++,this.line++,e=!0}else{if("*"!==this.source.charAt(this.index))throw Error("Unterminated comment at line "+this.line+": /"+this.source.charAt(this.index));for(i="";i+(i=this.source.charAt(this.index))!=="*/";)if(this.index++,"\n"===i&&this.line++,this.index===this.source.length)return null;this.index++,e=!0}}while(e);if(this.index===this.source.length)return null;var n=this.index;t.DELIM.lastIndex=0;var r=t.DELIM.test(this.source.charAt(n));if(r)++n;else for(++n;n<this.source.length&&!t.DELIM.test(this.source.charAt(n));)n++;var s=this.source.substring(this.index,this.index=n);return s===t.STRINGOPEN?(this.readingString=!0,this.stringEndsWith=t.STRINGCLOSE):s===t.STRINGOPEN_SQ&&(this.readingString=!0,this.stringEndsWith=t.STRINGCLOSE_SQ),s},r.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},r.toString=function(){return"Tokenizer("+this.index+"/"+this.source.length+" at line "+this.line+")"},i.Tokenizer=n;var s=function(e){this.tn=new n(e)},o=s.prototype;return o.parse=function(){for(var e,t={name:"[ROOT]","package":null,messages:[],enums:[],imports:[],options:{},services:[]},i=!0;e=this.tn.next();)switch(e){case"package":if(!i||null!==t["package"])throw Error("Unexpected package at line "+this.tn.line);t["package"]=this._parsePackage(e);break;case"import":if(!i)throw Error("Unexpected import at line "+this.tn.line);t.imports.push(this._parseImport(e));break;case"message":this._parseMessage(t,null,e),i=!1;break;case"enum":this._parseEnum(t,e),i=!1;break;case"option":this._parseOption(t,e);break;case"service":this._parseService(t,e);break;case"extend":this._parseExtend(t,e);break;case"syntax":this._parseIgnoredStatement(t,e);break;default:throw Error("Unexpected token at line "+this.tn.line+": "+e)}return delete t.name,t},o._parseNumber=function(e){var i=1;if("-"==e.charAt(0)&&(i=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return i*parseInt(e,10);if(t.NUMBER_HEX.test(e))return i*parseInt(e.substring(2),16);if(t.NUMBER_OCT.test(e))return i*parseInt(e.substring(1),8);if(t.NUMBER_FLT.test(e))return"inf"===e?i*(1/0):"nan"===e?NaN:i*parseFloat(e);throw Error("Illegal number at line "+this.tn.line+": "+(0>i?"-":"")+e)},o._parseString=function(){var e,i,n="";do{if(i=this.tn.next(),n+=this.tn.next(),e=this.tn.next(),e!==i)throw Error("Illegal end of string at line "+this.tn.line+": "+e);e=this.tn.peek()}while(e===t.STRINGOPEN||e===t.STRINGOPEN_SQ);return n},o._parseId=function(e,i){var n=-1,r=1;if("-"==e.charAt(0)&&(r=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))n=parseInt(e);else if(t.NUMBER_HEX.test(e))n=parseInt(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error("Illegal id at line "+this.tn.line+": "+(0>r?"-":"")+e);n=parseInt(e.substring(1),8)}if(n=r*n|0,!i&&0>n)throw Error("Illegal id at line "+this.tn.line+": "+(0>r?"-":"")+e);return n},o._parsePackage=function(e){if(e=this.tn.next(),!t.TYPEREF.test(e))throw Error("Illegal package name at line "+this.tn.line+": "+e);var i=e;if(e=this.tn.next(),e!=t.END)throw Error("Illegal end of package at line "+this.tn.line+": "+e);return i},o._parseImport=function(e){if(e=this.tn.peek(),"public"===e&&(this.tn.next(),e=this.tn.peek()),e!==t.STRINGOPEN&&e!==t.STRINGOPEN_SQ)throw Error("Illegal start of import at line "+this.tn.line+": "+e);var i=this._parseString();if(e=this.tn.next(),e!==t.END)throw Error("Illegal end of import at line "+this.tn.line+": "+e);return i},o._parseOption=function(e,i){i=this.tn.next();var n=!1;if(i==t.COPTOPEN&&(n=!0,i=this.tn.next()),!t.TYPEREF.test(i)&&!/google\.protobuf\./.test(i))throw Error("Illegal option name in message "+e.name+" at line "+this.tn.line+": "+i);var r=i;if(i=this.tn.next(),n){if(i!==t.COPTCLOSE)throw Error("Illegal end in message "+e.name+", option "+r+" at line "+this.tn.line+": "+i);r="("+r+")",i=this.tn.next(),t.FQTYPEREF.test(i)&&(r+=i,i=this.tn.next())}if(i!==t.EQUAL)throw Error("Illegal operator in message "+e.name+", option "+r+" at line "+this.tn.line+": "+i);var s;if(i=this.tn.peek(),i===t.STRINGOPEN||i===t.STRINGOPEN_SQ)s=this._parseString();else if(this.tn.next(),t.NUMBER.test(i))s=this._parseNumber(i,!0);else if(t.BOOL.test(i))s="true"===i;else{if(!t.TYPEREF.test(i))throw Error("Illegal option value in message "+e.name+", option "+r+" at line "+this.tn.line+": "+i);s=i}if(i=this.tn.next(),i!==t.END)throw Error("Illegal end of option in message "+e.name+", option "+r+" at line "+this.tn.line+": "+i);e.options[r]=s},o._parseIgnoredStatement=function(e,i){for(var n;;){if(n=this.tn.next(),null===n)throw Error("Unexpected EOF in "+e.name+", "+i+" at line "+this.tn.line);if(n===t.END)break}},o._parseService=function(e,i){if(i=this.tn.next(),!t.NAME.test(i))throw Error("Illegal service name at line "+this.tn.line+": "+i);var n=i,r={name:n,rpc:{},options:{}};if(i=this.tn.next(),i!==t.OPEN)throw Error("Illegal start of service "+n+" at line "+this.tn.line+": "+i);do if(i=this.tn.next(),"option"===i)this._parseOption(r,i);else if("rpc"===i)this._parseServiceRPC(r,i);else if(i!==t.CLOSE)throw Error("Illegal type of service "+n+" at line "+this.tn.line+": "+i);while(i!==t.CLOSE);e.services.push(r)},o._parseServiceRPC=function(e,i){var n=i;if(i=this.tn.next(),!t.NAME.test(i))throw Error("Illegal method name in service "+e.name+" at line "+this.tn.line+": "+i);var r=i,s={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(i=this.tn.next(),i!==t.COPTOPEN)throw Error("Illegal start of request type in service "+e.name+"#"+r+" at line "+this.tn.line+": "+i);if(i=this.tn.next(),"stream"===i.toLowerCase()&&(s.request_stream=!0,i=this.tn.next()),!t.TYPEREF.test(i))throw Error("Illegal request type in service "+e.name+"#"+r+" at line "+this.tn.line+": "+i);if(s.request=i,i=this.tn.next(),i!=t.COPTCLOSE)throw Error("Illegal end of request type in service "+e.name+"#"+r+" at line "+this.tn.line+": "+i);if(i=this.tn.next(),"returns"!==i.toLowerCase())throw Error("Illegal delimiter in service "+e.name+"#"+r+" at line "+this.tn.line+": "+i);if(i=this.tn.next(),i!=t.COPTOPEN)throw Error("Illegal start of response type in service "+e.name+"#"+r+" at line "+this.tn.line+": "+i);if(i=this.tn.next(),"stream"===i.toLowerCase()&&(s.response_stream=!0,i=this.tn.next()),s.response=i,i=this.tn.next(),i!==t.COPTCLOSE)throw Error("Illegal end of response type in service "+e.name+"#"+r+" at line "+this.tn.line+": "+i);if(i=this.tn.next(),i===t.OPEN){do if(i=this.tn.next(),"option"===i)this._parseOption(s,i);else if(i!==t.CLOSE)throw Error("Illegal start of option inservice "+e.name+"#"+r+" at line "+this.tn.line+": "+i);while(i!==t.CLOSE);this.tn.peek()===t.END&&this.tn.next()}else if(i!==t.END)throw Error("Illegal delimiter in service "+e.name+"#"+r+" at line "+this.tn.line+": "+i);"undefined"==typeof e[n]&&(e[n]={}),e[n][r]=s},o._parseMessage=function(e,i,n){var r={},s="group"===n;if(n=this.tn.next(),!t.NAME.test(n))throw Error("Illegal "+(s?"group":"message")+" name"+(e?" in message "+e.name:"")+" at line "+this.tn.line+": "+n);if(r.name=n,s){if(n=this.tn.next(),n!==t.EQUAL)throw Error("Illegal id assignment after group "+r.name+" at line "+this.tn.line+": "+n);n=this.tn.next();try{i.id=this._parseId(n)}catch(o){throw Error("Illegal field id value for group "+r.name+"#"+i.name+" at line "+this.tn.line+": "+n)}r.isGroup=!0}if(r.fields=[],r.enums=[],r.messages=[],r.options={},r.oneofs={},n=this.tn.next(),n===t.OPTOPEN&&i&&(this._parseFieldOptions(r,i,n),n=this.tn.next()),n!==t.OPEN)throw Error("Illegal start of "+(s?"group":"message")+" "+r.name+" at line "+this.tn.line+": "+n);for(;;){if(n=this.tn.next(),n===t.CLOSE){n=this.tn.peek(),n===t.END&&this.tn.next();break}if(t.RULE.test(n))this._parseMessageField(r,n);else if("oneof"===n)this._parseMessageOneOf(r,n);else if("enum"===n)this._parseEnum(r,n);else if("message"===n)this._parseMessage(r,null,n);else if("option"===n)this._parseOption(r,n);else if("extensions"===n)r.extensions=this._parseExtensions(r,n);else{if("extend"!==n)throw Error("Illegal token in message "+r.name+" at line "+this.tn.line+": "+n);this._parseExtend(r,n)}}return e.messages.push(r),r},o._parseMessageField=function(e,i){var n={},r=null;if(n.rule=i,n.options={},i=this.tn.next(),"group"===i){if(r=this._parseMessage(e,n,i),!/^[A-Z]/.test(r.name))throw Error("Group names must start with a capital letter");n.type=r.name,n.name=r.name.toLowerCase(),i=this.tn.peek(),i===t.END&&this.tn.next()}else{if(!t.TYPE.test(i)&&!t.TYPEREF.test(i))throw Error("Illegal field type in message "+e.name+" at line "+this.tn.line+": "+i);if(n.type=i,i=this.tn.next(),!t.NAME.test(i))throw Error("Illegal field name in message "+e.name+" at line "+this.tn.line+": "+i);if(n.name=i,i=this.tn.next(),i!==t.EQUAL)throw Error("Illegal token in field "+e.name+"#"+n.name+" at line "+this.tn.line+": "+i);i=this.tn.next();try{n.id=this._parseId(i)}catch(s){throw Error("Illegal field id in message "+e.name+"#"+n.name+" at line "+this.tn.line+": "+i)}if(i=this.tn.next(),i===t.OPTOPEN&&(this._parseFieldOptions(e,n,i),i=this.tn.next()),i!==t.END)throw Error("Illegal delimiter in message "+e.name+"#"+n.name+" at line "+this.tn.line+": "+i)}return e.fields.push(n),n},o._parseMessageOneOf=function(e,i){if(i=this.tn.next(),!t.NAME.test(i))throw Error("Illegal oneof name in message "+e.name+" at line "+this.tn.line+": "+i);var n,r=i,s=[];if(i=this.tn.next(),i!==t.OPEN)throw Error("Illegal start of oneof "+r+" at line "+this.tn.line+": "+i);for(;this.tn.peek()!==t.CLOSE;)n=this._parseMessageField(e,"optional"),n.oneof=r,s.push(n.id);this.tn.next(),e.oneofs[r]=s},o._parseFieldOptions=function(e,i,n){for(var r=!0;;){if(n=this.tn.next(),n===t.OPTCLOSE)break;if(n===t.OPTEND){if(r)throw Error("Illegal start of options in message "+e.name+"#"+i.name+" at line "+this.tn.line+": "+n);n=this.tn.next()}this._parseFieldOption(e,i,n),r=!1}},o._parseFieldOption=function(e,i,n){var r=!1;if(n===t.COPTOPEN&&(n=this.tn.next(),r=!0),!t.TYPEREF.test(n))throw Error("Illegal field option in "+e.name+"#"+i.name+" at line "+this.tn.line+": "+n);var s=n;if(n=this.tn.next(),r){if(n!==t.COPTCLOSE)throw Error("Illegal delimiter in "+e.name+"#"+i.name+" at line "+this.tn.line+": "+n);s="("+s+")",n=this.tn.next(),t.FQTYPEREF.test(n)&&(s+=n,n=this.tn.next())}if(n!==t.EQUAL)throw Error("Illegal token in "+e.name+"#"+i.name+" at line "+this.tn.line+": "+n);var o;if(n=this.tn.peek(),n===t.STRINGOPEN||n===t.STRINGOPEN_SQ)o=this._parseString();else if(t.NUMBER.test(n,!0))o=this._parseNumber(this.tn.next(),!0);else if(t.BOOL.test(n))o="true"===this.tn.next().toLowerCase();else{if(!t.TYPEREF.test(n))throw Error("Illegal value in message "+e.name+"#"+i.name+", option "+s+" at line "+this.tn.line+": "+n);o=this.tn.next()}i.options[s]=o},o._parseEnum=function(e,i){var n={};if(i=this.tn.next(),!t.NAME.test(i))throw Error("Illegal enum name in message "+e.name+" at line "+this.tn.line+": "+i);if(n.name=i,i=this.tn.next(),i!==t.OPEN)throw Error("Illegal start of enum "+n.name+" at line "+this.tn.line+": "+i);for(n.values=[],n.options={};;){if(i=this.tn.next(),i===t.CLOSE){i=this.tn.peek(),i===t.END&&this.tn.next();break}if("option"==i)this._parseOption(n,i);else{if(!t.NAME.test(i))throw Error("Illegal name in enum "+n.name+" at line "+this.tn.line+": "+i);this._parseEnumValue(n,i)}}e.enums.push(n)},o._parseEnumValue=function(e,i){var n={};if(n.name=i,i=this.tn.next(),i!==t.EQUAL)throw Error("Illegal token in enum "+e.name+" at line "+this.tn.line+": "+i);i=this.tn.next();try{n.id=this._parseId(i,!0)}catch(r){throw Error("Illegal id in enum "+e.name+" at line "+this.tn.line+": "+i)}if(e.values.push(n),i=this.tn.next(),i===t.OPTOPEN){var s={options:{}};this._parseFieldOptions(e,s,i),i=this.tn.next()}if(i!==t.END)throw Error("Illegal delimiter in enum "+e.name+" at line "+this.tn.line+": "+i)},o._parseExtensions=function(i,n){var r=[];if(n=this.tn.next(),"min"===n?r.push(e.ID_MIN):"max"===n?r.push(e.ID_MAX):r.push(this._parseNumber(n)),n=this.tn.next(),"to"!==n)throw Error("Illegal extensions delimiter in message "+i.name+" at line "+this.tn.line+": "+n);if(n=this.tn.next(),"min"===n?r.push(e.ID_MIN):"max"===n?r.push(e.ID_MAX):r.push(this._parseNumber(n)),n=this.tn.next(),n!==t.END)throw Error("Illegal extensions delimiter in message "+i.name+" at line "+this.tn.line+": "+n);return r},o._parseExtend=function(e,i){if(i=this.tn.next(),!t.TYPEREF.test(i))throw Error("Illegal message name at line "+this.tn.line+": "+i);var n={};if(n.ref=i,n.fields=[],i=this.tn.next(),i!==t.OPEN)throw Error("Illegal start of extend "+n.name+" at line "+this.tn.line+": "+i);for(;;){if(i=this.tn.next(),i===t.CLOSE){i=this.tn.peek(),i==t.END&&this.tn.next();break}if(!t.RULE.test(i))throw Error("Illegal token in extend "+n.name+" at line "+this.tn.line+": "+i);this._parseMessageField(n,i)}return e.messages.push(n),n},o.toString=function(){return"Parser"},i.Parser=s,i}(t,t.Lang),t.Reflect=function(t){function i(e,n){var r=n.readVarint32(),s=7&r,o=r>>3;switch(s){case t.WIRE_TYPES.VARINT:do r=n.readUint8();while(128===(128&r));break;case t.WIRE_TYPES.BITS64:n.offset+=8;break;case t.WIRE_TYPES.LDELIM:r=n.readVarint32(),n.offset+=r;break;case t.WIRE_TYPES.STARTGROUP:i(o,n);break;case t.WIRE_TYPES.ENDGROUP:if(o===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+o+" ("+e+" expected)");case t.WIRE_TYPES.BITS32:n.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+s)}return!0}function n(e,i){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low===e.low&&e.high===e.high)return new t.Long(e.low,e.high,"undefined"==typeof i?e.unsigned:i);if("string"==typeof e)return t.Long.fromString(e,i||!1,10);if("number"==typeof e)return t.Long.fromNumber(e,i||!1);throw Error("not convertible to Long")}var r={},s=function(e,t,i){this.builder=e,this.parent=t,this.name=i,this.className},o=s.prototype;o.fqn=function(){for(var e=this.name,t=this;;){if(t=t.parent,null==t)break;e=t.name+"."+e}return e},o.toString=function(e){return(e?this.className+" ":"")+this.fqn()},o.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},r.T=s;var a=function(e,t,i,n){s.call(this,e,t,i),this.className="Namespace",this.children=[],this.options=n||{}},l=a.prototype=Object.create(s.prototype);l.getChildren=function(e){if(e=e||null,null==e)return this.children.slice();for(var t=[],i=0,n=this.children.length;n>i;++i)this.children[i]instanceof e&&t.push(this.children[i]);return t},l.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof f.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof f.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},l.getChild=function(e){for(var t="number"==typeof e?"id":"name",i=0,n=this.children.length;n>i;++i)if(this.children[i][t]===e)return this.children[i];return null},l.resolve=function(e,t){var i="string"==typeof e?e.split("."):e,n=this,s=0;if(""===i[s]){for(;null!==n.parent;)n=n.parent;s++}var o;do{do{if(o=n.getChild(i[s]),!o||!(o instanceof r.T)||t&&o instanceof r.Message.Field){n=null;break}n=o,s++}while(s<i.length);if(null!=n)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=n);return n},l.qn=function(e){var t=[],i=e;do t.unshift(i.name),i=i.parent;while(null!==i);for(var n=1;n<=t.length;n++){var r=t.slice(t.length-n);if(e===this.resolve(r))return r.join(".")}return e.fqn()},l.build=function(){for(var e,t={},i=this.children,n=0,r=i.length;r>n;++n)e=i[n],e instanceof a&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt()}),t},l.buildOpt=function(){for(var e={},t=Object.keys(this.options),i=0,n=t.length;n>i;++i){var r=t[i],s=this.options[t[i]];e[r]=s}return e},l.getOption=function(e){return"undefined"==typeof e?this.options:"undefined"!=typeof this.options[e]?this.options[e]:null},r.Namespace=a;var f=function(e,i,n,r,s){a.call(this,e,i,n,r),this.className="Message",this.extensions=[t.ID_MIN,t.ID_MAX],this.clazz=null,this.isGroup=!!s,this._fields=null,this._fieldsById=null,this._fieldsByName=null},h=f.prototype=Object.create(a.prototype);h.build=function(i){if(this.clazz&&!i)return this.clazz;var n=function(t,i){function n(t,i){var r={};for(var s in t)t.hasOwnProperty(s)&&(null===t[s]||"object"!=typeof t[s]?r[s]=t[s]:t[s]instanceof e?i&&(r[s]=t[s].toBase64()):r[s]=n(t[s],i));return r}var r=i.getChildren(t.Reflect.Message.Field),s=i.getChildren(t.Reflect.Message.OneOf),o=function(i,n){t.Builder.Message.call(this);for(var o=0,a=s.length;a>o;++o)this[s[o].name]=null;for(o=0,a=r.length;a>o;++o){var l=r[o];this[l.name]=l.repeated?[]:null,l.required&&null!==l.defaultValue&&(this[l.name]=l.defaultValue)}if(arguments.length>0){var f;if(1!==arguments.length||"object"!=typeof i||"function"==typeof i.encode||t.Util.isArray(i)||i instanceof e||i instanceof ArrayBuffer||t.Long&&i instanceof t.Long)for(o=0,a=arguments.length;a>o;++o)"undefined"!=typeof(f=arguments[o])&&this.$set(r[o].name,f);else this.$set(i)}},a=o.prototype=Object.create(t.Builder.Message.prototype);a.add=function(e,n,r){var s=i._fieldsByName[e];if(!r){if(!s)throw Error(this+"#"+e+" is undefined");if(!(s instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+s.toString(!0));if(!s.repeated)throw Error(this+"#"+e+" is not a repeated field")}null===this[s.name]&&(this[s.name]=[]),this[s.name].push(r?n:s.verifyValue(n,!0))},a.$add=a.add,a.set=function(e,n,r){if(e&&"object"==typeof e){r=n;for(var s in e)e.hasOwnProperty(s)&&"undefined"!=typeof(n=e[s])&&this.$set(s,n,r);return this}var o=i._fieldsByName[e];if(r)this[o.name]=n;else{if(!o)throw Error(this+"#"+e+" is not a field: undefined");if(!(o instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+o.toString(!0));this[o.name]=n=o.verifyValue(n)}return o.oneof&&(null!==n?(null!==this[o.oneof.name]&&(this[this[o.oneof.name]]=null),this[o.oneof.name]=o.name):o.oneof.name===e&&(this[o.oneof.name]=null)),this},a.$set=a.set,a.get=function(e,n){if(n)return this[e];var r=i._fieldsByName[e];if(!(r&&r instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(!(r instanceof t.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+r.toString(!0));return this[r.name]},a.$get=a.get;for(var l=0;l<r.length;l++){var f=r[l];f instanceof t.Reflect.Message.ExtensionField||i.builder.options.populateAccessors&&function(e){var t=e.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")});t=t.substring(0,1).toUpperCase()+t.substring(1);var n=e.originalName.replace(/([A-Z])/g,function(e){return"_"+e}),r=function(t,i){return this[e.name]=i?t:e.verifyValue(t),this},s=function(){return this[e.name]};null===i.getChild("set"+t)&&(a["set"+t]=r),null===i.getChild("set_"+n)&&(a["set_"+n]=r),null===i.getChild("get"+t)&&(a["get"+t]=s),null===i.getChild("get_"+n)&&(a["get_"+n]=s)}(f)}a.encode=function(t,n){"boolean"==typeof t&&(n=t,t=void 0);var r=!1;t||(t=new e,r=!0);var s=t.littleEndian;try{return i.encode(this,t.LE(),n),(r?t.flip():t).LE(s)}catch(o){throw t.LE(s),o}},a.calculate=function(){return i.calculate(this)},a.encodeDelimited=function(t){var n=!1;t||(t=new e,n=!0);var r=(new e).LE();return i.encode(this,r).flip(),t.writeVarint32(r.remaining()),t.append(r),n?t.flip():t},a.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},a.toArrayBuffer=a.encodeAB,a.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},a.toBuffer=a.encodeNB,a.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},a.toBase64=a.encode64,a.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},a.toHex=a.encodeHex,a.toRaw=function(e){return n(this,!!e)},o.decode=function(t,n){"string"==typeof t&&(t=e.wrap(t,n?n:"base64")),t=t instanceof e?t:e.wrap(t);var r=t.littleEndian;try{var s=i.decode(t.LE());return t.LE(r),s}catch(o){throw t.LE(r),o}},o.decodeDelimited=function(t,n){if("string"==typeof t&&(t=e.wrap(t,n?n:"base64")),t=t instanceof e?t:e.wrap(t),t.remaining()<1)return null;var r=t.offset,s=t.readVarint32();if(t.remaining()<s)return t.offset=r,null;try{var o=i.decode(t.slice(t.offset,t.offset+s).LE());return t.offset+=s,o}catch(a){throw t.offset+=s,a}},o.decode64=function(e){return o.decode(e,"base64")},o.decodeHex=function(e){return o.decode(e,"hex")},a.toString=function(){return i.toString()};return Object.defineProperty&&(Object.defineProperty(o,"$options",{value:i.buildOpt()}),Object.defineProperty(a,"$options",{value:o.$options}),Object.defineProperty(o,"$type",{value:i}),Object.defineProperty(a,"$type",{value:i})),o}(t,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,s=0,o=this.children.length;o>s;s++)if(r=this.children[s],r instanceof E)n[r.name]=r.build();else if(r instanceof f)n[r.name]=r.build();else if(r instanceof f.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof f.OneOf||r instanceof y))throw Error("Illegal reflect child of "+this.toString(!0)+": "+children[s].toString(!0));return this.clazz=n},h.encode=function(e,t,i){for(var n,r,s=null,o=0,a=this._fields.length;a>o;++o)n=this._fields[o],r=e[n.name],n.required&&null===r?null===s&&(s=n):n.encode(i?r:n.verifyValue(r),t);if(null!==s){var l=Error("Missing at least one required field for "+this.toString(!0)+": "+s);throw l.encoded=t,l}return t},h.calculate=function(e){for(var t,i,n=0,r=0,s=this._fields.length;s>r;++r){if(t=this._fields[r],i=e[t.name],t.required&&null===i)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);n+=t.calculate(i)}return n},h.decode=function(e,n,r){n="number"==typeof n?n:-1;for(var s,o,a,l,f=e.offset,h=new this.clazz;e.offset<f+n||-1===n&&e.remaining()>0;){if(s=e.readVarint32(),o=7&s,a=s>>3,o===t.WIRE_TYPES.ENDGROUP){if(a!==r)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+a+" ("+(r?r+" expected":"not a group")+")");break}if(l=this._fieldsById[a])l.repeated&&!l.options.packed?h[l.name].push(l.decode(o,e)):(h[l.name]=l.decode(o,e),l.oneof&&(null!==this[l.oneof.name]&&(this[this[l.oneof.name]]=null),h[l.oneof.name]=l.name));else switch(o){case t.WIRE_TYPES.VARINT:e.readVarint32();break;case t.WIRE_TYPES.BITS32:e.offset+=4;break;case t.WIRE_TYPES.BITS64:e.offset+=8;break;case t.WIRE_TYPES.LDELIM:var u=e.readVarint32();e.offset+=u;break;case t.WIRE_TYPES.STARTGROUP:for(;i(a,e););break;default:throw Error("Illegal wire type for unknown field "+a+" in "+this.toString(!0)+"#decode: "+o)}}for(var p=0,c=this._fields.length;c>p;++p)if(l=this._fields[p],null===h[l.name]){if(l.required){var d=Error("Missing at least one required field for "+this.toString(!0)+": "+l.name);throw d.decoded=h,d}null!==l.defaultValue&&(h[l.name]=l.defaultValue)}return h},r.Message=f;var u=function(e,t,i,n,r,o,a,l){s.call(this,e,t,r),this.className="Message.Field",this.required="required"===i,this.repeated="repeated"===i,this.type=n,this.resolvedType=null,this.id=o,this.options=a||{},this.defaultValue=null,this.oneof=l||null,this.originalName=this.name,!this.builder.options.convertFieldsToCamelCase||this instanceof f.ExtensionField||(this.name=u._toCamelCase(this.name))};u._toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})};var p=u.prototype=Object.create(s.prototype);p.build=function(){this.defaultValue="undefined"!=typeof this.options["default"]?this.verifyValue(this.options["default"]):null},p.verifyValue=function(i,r){r=r||!1;var s=function(e,t){throw Error("Illegal value for "+this.toString(!0)+" of type "+this.type.name+": "+e+" ("+t+")")}.bind(this);if(null===i)return this.required&&s(typeof i,"required"),null;var o;if(this.repeated&&!r){t.Util.isArray(i)||(i=[i]);var a=[];for(o=0;o<i.length;o++)a.push(this.verifyValue(i[o],!0));return a}switch(!this.repeated&&t.Util.isArray(i)&&s(typeof i,"no array expected"),this.type){case t.TYPES.int32:case t.TYPES.sint32:case t.TYPES.sfixed32:return("number"!=typeof i||i===i&&i%1!==0)&&s(typeof i,"not an integer"),i>4294967295?0|i:i;case t.TYPES.uint32:case t.TYPES.fixed32:return("number"!=typeof i||i===i&&i%1!==0)&&s(typeof i,"not an integer"),0>i?i>>>0:i;case t.TYPES.int64:case t.TYPES.sint64:case t.TYPES.sfixed64:if(t.Long)try{return n(i,!1)}catch(l){s(typeof i,l.message)}else s(typeof i,"requires Long.js");case t.TYPES.uint64:case t.TYPES.fixed64:if(t.Long)try{return n(i,!0)}catch(l){s(typeof i,l.message)}else s(typeof i,"requires Long.js");case t.TYPES.bool:return"boolean"!=typeof i&&s(typeof i,"not a boolean"),i;case t.TYPES["float"]:case t.TYPES["double"]:return"number"!=typeof i&&s(typeof i,"not a number"),i;case t.TYPES.string:return"string"==typeof i||i&&i instanceof String||s(typeof i,"not a string"),""+i;case t.TYPES.bytes:return e.isByteBuffer(i)?i:e.wrap(i,"utf8");case t.TYPES["enum"]:var f=this.resolvedType.getChildren(E.Value);for(o=0;o<f.length;o++){if(f[o].name==i)return f[o].id;if(f[o].id==i)return f[o].id}s(i,"not a valid enum value");case t.TYPES.group:case t.TYPES.message:if(i&&"object"==typeof i||s(typeof i,"object expected"),i instanceof this.resolvedType.clazz)return i;if(i instanceof t.Builder.Message){var h={};for(var o in i)i.hasOwnProperty(o)&&(h[o]=i[o]);i=h}return new this.resolvedType.clazz(i)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+i+" (undefined type "+this.type+")")},p.encode=function(i,n){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return n;try{if(this.repeated){var r;if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){n.writeVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),n.ensureCapacity(n.offset+=1);var s=n.offset;for(r=0;r<i.length;r++)this.encodeValue(i[r],n);var o=n.offset-s,a=e.calculateVarint32(o);if(a>1){var l=n.slice(s,n.offset);s+=a-1,n.offset=s,n.append(l)}n.writeVarint32(o,s-a)}else for(r=0;r<i.length;r++)n.writeVarint32(this.id<<3|this.type.wireType),this.encodeValue(i[r],n)}else n.writeVarint32(this.id<<3|this.type.wireType),this.encodeValue(i,n)}catch(f){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+f+")")}return n},p.encodeValue=function(i,n){if(null===i)return n;switch(this.type){case t.TYPES.int32:0>i?n.writeVarint64(i):n.writeVarint32(i);break;case t.TYPES.uint32:n.writeVarint32(i);break;case t.TYPES.sint32:n.writeVarint32ZigZag(i);break;case t.TYPES.fixed32:n.writeUint32(i);break;case t.TYPES.sfixed32:n.writeInt32(i);break;case t.TYPES.int64:case t.TYPES.uint64:n.writeVarint64(i);break;case t.TYPES.sint64:n.writeVarint64ZigZag(i);break;case t.TYPES.fixed64:n.writeUint64(i);break;case t.TYPES.sfixed64:n.writeInt64(i);break;case t.TYPES.bool:"string"==typeof i?n.writeVarint32("false"===i.toLowerCase()?0:!!i):n.writeVarint32(i?1:0);
break;case t.TYPES["enum"]:n.writeVarint32(i);break;case t.TYPES["float"]:n.writeFloat32(i);break;case t.TYPES["double"]:n.writeFloat64(i);break;case t.TYPES.string:n.writeVString(i);break;case t.TYPES.bytes:if(i.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+i.remaining()+" bytes remaining");var r=i.offset;n.writeVarint32(i.remaining()),n.append(i),i.offset=r;break;case t.TYPES.message:var s=(new e).LE();this.resolvedType.encode(i,s),n.writeVarint32(s.offset),n.append(s.flip());break;case t.TYPES.group:this.resolvedType.encode(i,n),n.writeVarint32(this.id<<3|t.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+i+" (unknown type)")}return n},p.calculate=function(i){if(i=this.verifyValue(i),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return 0;var n=0;try{if(this.repeated){var r,s;if(this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(n+=e.calculateVarint32(this.id<<3|t.WIRE_TYPES.LDELIM),s=0,r=0;r<i.length;r++)s+=this.calculateValue(i[r]);n+=e.calculateVarint32(s),n+=s}else for(r=0;r<i.length;r++)n+=e.calculateVarint32(this.id<<3|this.type.wireType),n+=this.calculateValue(i[r])}else n+=e.calculateVarint32(this.id<<3|this.type.wireType),n+=this.calculateValue(i)}catch(o){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+o+")")}return n},p.calculateValue=function(i){if(null===i)return 0;var n;switch(this.type){case t.TYPES.int32:return 0>i?e.calculateVarint64(i):e.calculateVarint32(i);case t.TYPES.uint32:return e.calculateVarint32(i);case t.TYPES.sint32:return e.calculateVarint32(e.zigZagEncode32(i));case t.TYPES.fixed32:case t.TYPES.sfixed32:case t.TYPES["float"]:return 4;case t.TYPES.int64:case t.TYPES.uint64:return e.calculateVarint64(i);case t.TYPES.sint64:return e.calculateVarint64(e.zigZagEncode64(i));case t.TYPES.fixed64:case t.TYPES.sfixed64:return 8;case t.TYPES.bool:return 1;case t.TYPES["enum"]:return e.calculateVarint32(i);case t.TYPES["double"]:return 8;case t.TYPES.string:return n=e.calculateUTF8Bytes(i),e.calculateVarint32(n)+n;case t.TYPES.bytes:if(i.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+i.remaining()+" bytes remaining");return e.calculateVarint32(i.remaining())+i.remaining();case t.TYPES.message:return n=this.resolvedType.calculate(i),e.calculateVarint32(n)+n;case t.TYPES.group:return n=this.resolvedType.calculate(i),n+e.calculateVarint32(this.id<<3|t.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+i+" (unknown type)")},p.decode=function(e,i,n){var r,s;if(e!=this.type.wireType&&(n||e!=t.WIRE_TYPES.LDELIM||!this.repeated))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==t.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&t.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!n){s=i.readVarint32(),s=i.offset+s;for(var o=[];i.offset<s;)o.push(this.decode(this.type.wireType,i,!0));return o}switch(this.type){case t.TYPES.int32:return 0|i.readVarint32();case t.TYPES.uint32:return i.readVarint32()>>>0;case t.TYPES.sint32:return 0|i.readVarint32ZigZag();case t.TYPES.fixed32:return i.readUint32()>>>0;case t.TYPES.sfixed32:return 0|i.readInt32();case t.TYPES.int64:return i.readVarint64();case t.TYPES.uint64:return i.readVarint64().toUnsigned();case t.TYPES.sint64:return i.readVarint64ZigZag();case t.TYPES.fixed64:return i.readUint64();case t.TYPES.sfixed64:return i.readInt64();case t.TYPES.bool:return!!i.readVarint32();case t.TYPES["enum"]:return i.readVarint32();case t.TYPES["float"]:return i.readFloat();case t.TYPES["double"]:return i.readDouble();case t.TYPES.string:return i.readVString();case t.TYPES.bytes:if(s=i.readVarint32(),i.remaining()<s)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+s+" required but got only "+i.remaining());return r=i.clone(),r.limit=r.offset+s,i.offset+=s,r;case t.TYPES.message:return s=i.readVarint32(),this.resolvedType.decode(i,s);case t.TYPES.group:return this.resolvedType.decode(i,-1,this.id)}throw Error("[INTERNAL] Illegal wire type for "+this.toString(!0)+": "+e)},r.Message.Field=u;var c=function(e,t,i,n,r,s,o){u.call(this,e,t,i,n,r,s,o),this.extension};c.prototype=Object.create(u.prototype),r.Message.ExtensionField=c;var d=function(e,t,i){s.call(this,e,t,i),this.fields=[]};r.Message.OneOf=d;var E=function(e,t,i,n){a.call(this,e,t,i,n),this.className="Enum",this.object=null},g=E.prototype=Object.create(a.prototype);g.build=function(){for(var e={},t=this.getChildren(E.Value),i=0,n=t.length;n>i;++i)e[t[i].name]=t[i].id;return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt()}),this.object=e},r.Enum=E;var m=function(e,t,i,n){s.call(this,e,t,i),this.className="Enum.Value",this.id=n};m.prototype=Object.create(s.prototype),r.Enum.Value=m;var y=function(e,t,i,n){s.call(this,e,t,i),this.field=n};y.prototype=Object.create(s.prototype),r.Extension=y;var T=function(e,t,i,n){a.call(this,e,t,i,n),this.className="Service",this.clazz=null},v=T.prototype=Object.create(a.prototype);v.build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(e,t){for(var i=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(e,t,i){setTimeout(i.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},n=i.prototype=Object.create(e.Builder.Service.prototype),r=t.getChildren(e.Reflect.Service.RPCMethod),s=0;s<r.length;s++)!function(e){n[e.name]=function(i,n){try{if(!(i&&i instanceof e.resolvedRequestType.clazz))return void setTimeout(n.bind(this,Error("Illegal request type provided to service method "+t.name+"#"+e.name)),0);this.rpcImpl(e.fqn(),i,function(i,r){if(i)return void n(i);try{r=e.resolvedResponseType.clazz.decode(r)}catch(s){}return r&&r instanceof e.resolvedResponseType.clazz?void n(null,r):void n(Error("Illegal response type received in service method "+t.name+"#"+e.name))})}catch(r){setTimeout(n.bind(this,r),0)}},i[e.name]=function(t,n,r){new i(t)[e.name](n,r)},Object.defineProperty&&(Object.defineProperty(i[e.name],"$options",{value:e.buildOpt()}),Object.defineProperty(n[e.name],"$options",{value:i[e.name].$options}))}(r[s]);return Object.defineProperty&&(Object.defineProperty(i,"$options",{value:t.buildOpt()}),Object.defineProperty(n,"$options",{value:i.$options}),Object.defineProperty(i,"$type",{value:t}),Object.defineProperty(n,"$type",{value:t})),i}(t,this)},r.Service=T;var S=function(e,t,i,n){s.call(this,e,t,i),this.className="Service.Method",this.options=n||{}},I=S.prototype=Object.create(s.prototype);I.buildOpt=l.buildOpt,r.Service.Method=S;var P=function(e,t,i,n,r,s,o,a){S.call(this,e,t,i,a),this.className="Service.RPCMethod",this.requestName=n,this.responseName=r,this.requestStream=s,this.responseStream=o,this.resolvedRequestType=null,this.resolvedResponseType=null};return P.prototype=Object.create(S.prototype),r.Service.RPCMethod=P,r}(t),t.Builder=function(e,t,i){var n=function(e){this.ns=new i.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},r=n.prototype;return r.reset=function(){this.ptr=this.ns},r.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("Illegal package: "+e);var n,r,s=e.split(".");for(n=0;n<s.length;n++)if(!t.NAME.test(s[n]))throw Error("Illegal package: "+s[n]);for(n=0;n<s.length;n++)r=this.ptr.getChild(s[n]),null===r&&this.ptr.addChild(r=new i.Namespace(this,this.ptr,s[n])),this.ptr=r;return this},n.isValidMessage=function(i){if("string"!=typeof i.name||!t.NAME.test(i.name))return!1;if("undefined"!=typeof i.values||"undefined"!=typeof i.rpc)return!1;var r;if("undefined"!=typeof i.fields){if(!e.Util.isArray(i.fields))return!1;var s,o=[];for(r=0;r<i.fields.length;r++){if(!n.isValidMessageField(i.fields[r]))return!1;if(s=parseInt(i.fields[r].id,10),o.indexOf(s)>=0)return!1;o.push(s)}o=null}if("undefined"!=typeof i.enums){if(!e.Util.isArray(i.enums))return!1;for(r=0;r<i.enums.length;r++)if(!n.isValidEnum(i.enums[r]))return!1}if("undefined"!=typeof i.messages){if(!e.Util.isArray(i.messages))return!1;for(r=0;r<i.messages.length;r++)if(!n.isValidMessage(i.messages[r])&&!n.isValidExtend(i.messages[r]))return!1}return"undefined"==typeof i.extensions||e.Util.isArray(i.extensions)&&2===i.extensions.length&&"number"==typeof i.extensions[0]&&"number"==typeof i.extensions[1]?!0:!1},n.isValidMessageField=function(e){if("string"!=typeof e.rule||"string"!=typeof e.name||"string"!=typeof e.type||"undefined"==typeof e.id)return!1;if(!(t.RULE.test(e.rule)&&t.NAME.test(e.name)&&t.TYPEREF.test(e.type)&&t.ID.test(""+e.id)))return!1;if("undefined"!=typeof e.options){if("object"!=typeof e.options)return!1;for(var i,n=Object.keys(e.options),r=0;r<n.length;r++)if("string"!=typeof(i=n[r])||"string"!=typeof e.options[i]&&"number"!=typeof e.options[i]&&"boolean"!=typeof e.options[i])return!1}return!0},n.isValidEnum=function(i){if("string"!=typeof i.name||!t.NAME.test(i.name))return!1;if("undefined"==typeof i.values||!e.Util.isArray(i.values)||0==i.values.length)return!1;for(var n=0;n<i.values.length;n++){if("object"!=typeof i.values[n])return!1;if("string"!=typeof i.values[n].name||"undefined"==typeof i.values[n].id)return!1;if(!t.NAME.test(i.values[n].name)||!t.NEGID.test(""+i.values[n].id))return!1}return!0},r.create=function(t){if(!t)return this;if(e.Util.isArray(t)||(t=[t]),0===t.length)return this;var r=[];for(r.push(t);r.length>0;){if(t=r.pop(),!e.Util.isArray(t))throw Error("Not a valid namespace: "+JSON.stringify(t));for(;t.length>0;){var s=t.shift();if(n.isValidMessage(s)){var o=new i.Message(this,this.ptr,s.name,s.options,s.isGroup),a={};if(s.oneofs)for(var l=Object.keys(s.oneofs),f=0,h=l.length;h>f;++f)o.addChild(a[l[f]]=new i.Message.OneOf(this,o,l[f]));if(s.fields&&s.fields.length>0)for(f=0,h=s.fields.length;h>f;++f){var u=s.fields[f];if(null!==o.getChild(u.id))throw Error("Duplicate field id in message "+o.name+": "+u.id);if(u.options)for(var p=Object.keys(u.options),c=0,d=p.length;d>c;++c){if("string"!=typeof p[c])throw Error("Illegal field option name in message "+o.name+"#"+u.name+": "+p[c]);if("string"!=typeof u.options[p[c]]&&"number"!=typeof u.options[p[c]]&&"boolean"!=typeof u.options[p[c]])throw Error("Illegal field option value in message "+o.name+"#"+u.name+"#"+p[c]+": "+u.options[p[c]])}var E=null;if("string"==typeof u.oneof&&(E=a[u.oneof],"undefined"==typeof E))throw Error("Illegal oneof in message "+o.name+"#"+u.name+": "+u.oneof);u=new i.Message.Field(this,o,u.rule,u.type,u.name,u.id,u.options,E),E&&E.fields.push(u),o.addChild(u)}var g=[];if("undefined"!=typeof s.enums&&s.enums.length>0)for(f=0;f<s.enums.length;f++)g.push(s.enums[f]);if(s.messages&&s.messages.length>0)for(f=0;f<s.messages.length;f++)g.push(s.messages[f]);if(s.extensions&&(o.extensions=s.extensions,o.extensions[0]<e.ID_MIN&&(o.extensions[0]=e.ID_MIN),o.extensions[1]>e.ID_MAX&&(o.extensions[1]=e.ID_MAX)),this.ptr.addChild(o),g.length>0){r.push(t),t=g,g=null,this.ptr=o,o=null;continue}g=null,o=null}else if(n.isValidEnum(s)){for(o=new i.Enum(this,this.ptr,s.name,s.options),f=0;f<s.values.length;f++)o.addChild(new i.Enum.Value(this,o,s.values[f].name,s.values[f].id));this.ptr.addChild(o),o=null}else if(n.isValidService(s)){o=new i.Service(this,this.ptr,s.name,s.options);for(f in s.rpc)s.rpc.hasOwnProperty(f)&&o.addChild(new i.Service.RPCMethod(this,o,f,s.rpc[f].request,s.rpc[f].response,s.rpc[f].request_stream,s.rpc[f].response_stream,s.rpc[f].options));this.ptr.addChild(o),o=null}else{if(!n.isValidExtend(s))throw Error("Not a valid definition: "+JSON.stringify(s));if(o=this.ptr.resolve(s.ref))for(f=0;f<s.fields.length;f++){if(null!==o.getChild(s.fields[f].id))throw Error("Duplicate extended field id in message "+o.name+": "+s.fields[f].id);if(s.fields[f].id<o.extensions[0]||s.fields[f].id>o.extensions[1])throw Error("Illegal extended field id in message "+o.name+": "+s.fields[f].id+" ("+o.extensions.join(" to ")+" expected)");var m=s.fields[f].name;this.options.convertFieldsToCamelCase&&(m=i.Message.Field._toCamelCase(s.fields[f].name)),u=new i.Message.ExtensionField(this,o,s.fields[f].rule,s.fields[f].type,this.ptr.fqn()+"."+m,s.fields[f].id,s.fields[f].options);var y=new i.Extension(this,this.ptr,s.fields[f].name,u);u.extension=y,this.ptr.addChild(y),o.addChild(u)}else if(!/\.?google\.protobuf\./.test(s.ref))throw Error("Extended message "+s.ref+" is not defined")}s=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},r["import"]=function(t,i){if("string"==typeof i){if(e.Util.IS_NODE&&(i=require("path").resolve(i)),this.files[i]===!0)return this.reset(),this;this.files[i]=!0}else if("object"==typeof i){var n=i.root;e.Util.IS_NODE&&(n=require("path").resolve(n));var r=[n,i.file].join("/");if(this.files[r]===!0)return this.reset(),this;this.files[r]=!0}if(t.imports&&t.imports.length>0){var s,o="/",a=!1;"object"==typeof i?(this.importRoot=i.root,a=!0,s=this.importRoot,i=i.file,(s.indexOf("\\")>=0||i.indexOf("\\")>=0)&&(o="\\")):"string"==typeof i?this.importRoot?s=this.importRoot:i.indexOf("/")>=0?(s=i.replace(/\/[^\/]*$/,""),""===s&&(s="/")):i.indexOf("\\")>=0?(s=i.replace(/\\[^\\]*$/,""),o="\\"):s=".":s=null;for(var l=0;l<t.imports.length;l++)if("string"==typeof t.imports[l]){if(!s)throw Error("Cannot determine import root: File name is unknown");var f=t.imports[l];if(/^google\/protobuf\//.test(f))continue;if(f=s+o+f,this.files[f]===!0)continue;/\.proto$/i.test(f)&&!e.DotProto&&(f=f.replace(/\.proto$/,".json"));var h=e.Util.fetch(f);if(null===h)throw Error("Failed to import '"+f+"' in '"+i+"': File not found");/\.json$/i.test(f)?this["import"](JSON.parse(h+""),f):this["import"](new e.DotProto.Parser(h+"").parse(),f)}else i?/\.(\w+)$/.test(i)?this["import"](t.imports[l],i.replace(/^(.+)\.(\w+)$/,function(e,t,i){return t+"_import"+l+"."+i})):this["import"](t.imports[l],i+"_import"+l):this["import"](t.imports[l]);a&&(this.importRoot=null)}t["package"]&&this.define(t["package"]);var u=this.ptr;return t.options&&Object.keys(t.options).forEach(function(e){u.options[e]=t.options[e]}),t.messages&&(this.create(t.messages),this.ptr=u),t.enums&&(this.create(t.enums),this.ptr=u),t.services&&(this.create(t.services),this.ptr=u),t["extends"]&&this.create(t["extends"]),this.reset(),this},n.isValidService=function(e){return!("string"!=typeof e.name||!t.NAME.test(e.name)||"object"!=typeof e.rpc)},n.isValidExtend=function(i){if("string"!=typeof i.ref||!t.TYPEREF.test(i.ref))return!1;var r;if("undefined"!=typeof i.fields){if(!e.Util.isArray(i.fields))return!1;var s,o=[];for(r=0;r<i.fields.length;r++){if(!n.isValidMessageField(i.fields[r]))return!1;if(s=parseInt(i.id,10),o.indexOf(s)>=0)return!1;o.push(s)}o=null}return!0},r.resolveAll=function(){var n;if(null!=this.ptr&&"object"!=typeof this.ptr.type){if(this.ptr instanceof i.Namespace)for(var r=this.ptr.children,s=0,o=r.length;o>s;++s)this.ptr=r[s],this.resolveAll();else if(this.ptr instanceof i.Message.Field)if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(n=(this.ptr instanceof i.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0),!n)throw Error("Unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=n,n instanceof i.Enum)this.ptr.type=e.TYPES["enum"];else{if(!(n instanceof i.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=n.isGroup?e.TYPES.group:e.TYPES.message}}else if(this.ptr instanceof e.Reflect.Enum.Value);else if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error("Illegal service type in "+this.ptr.toString(!0));if(n=this.ptr.parent.resolve(this.ptr.requestName),!(n&&n instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=n,n=this.ptr.parent.resolve(this.ptr.responseName),!(n&&n instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=n}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension))throw Error("Illegal object in namespace: "+typeof this.ptr+":"+this.ptr);this.reset()}},r.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),e){for(var t="string"==typeof e?e.split("."):e,i=this.result,n=0;n<t.length;n++){if(!i[t[n]]){i=null;break}i=i[t[n]]}return i}return this.result},r.lookup=function(e){return e?this.ns.resolve(e):this.ns},r.toString=function(){return"Builder"},n.Message=function(){},n.Service=function(){},n}(t,t.Lang,t.Reflect),t.loadProto=function(e,i,n){return("string"==typeof i||i&&"string"==typeof i.file&&"string"==typeof i.root)&&(n=i,i=void 0),t.loadJson(new t.DotProto.Parser(e).parse(),i,n)},t.protoFromString=t.loadProto,t.loadProtoFile=function(e,i,n){if(i&&"object"==typeof i?(n=i,i=null):i&&"function"==typeof i||(i=null),i)return t.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(r){if(null===r)return void i(Error("Failed to fetch file"));try{i(null,t.loadProto(r,n,e))}catch(s){i(s)}});var r=t.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===r?null:t.loadProto(r,n,e)},t.protoFromFile=t.loadProtoFile,t.newBuilder=function(e){return e=e||{},"undefined"==typeof e.convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=t.convertFieldsToCamelCase),"undefined"==typeof e.populateAccessors&&(e.populateAccessors=t.populateAccessors),new t.Builder(e)},t.loadJson=function(e,i,n){return("string"==typeof i||i&&"string"==typeof i.file&&"string"==typeof i.root)&&(n=i,i=null),i&&"object"==typeof i||(i=t.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),i["import"](e,n),i.resolveAll(),i},t.loadJsonFile=function(e,i,n){if(i&&"object"==typeof i?(n=i,i=null):i&&"function"==typeof i||(i=null),i)return t.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(r){if(null===r)return void i(Error("Failed to fetch file"));try{i(null,t.loadJson(JSON.parse(r),n,e))}catch(s){i(s)}});var r=t.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===r?null:t.loadJson(JSON.parse(r),n,e)},t}"function"==typeof require&&"object"==typeof module&&module&&"object"==typeof exports&&exports?module.exports=t(require("bytebuffer")):"function"==typeof define&&define.amd?define(["ByteBuffer"],t):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)}(this);